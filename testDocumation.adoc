# Testdokumentation

RestConfig erstellen!

[source, java]
----
package at.htl.formula1.boundary;

import javax.ws.rs.ApplicationPath;
import javax.ws.rs.core.Application;

@ApplicationPath("api")
public class RestConfig extends Application {
}
----

LocalDateConverter gel√∂scht.

### Aufgabe 1

#### Import von CSV

races.csv import
[source, java]
----
ClassLoader classLoader = getClass().getClassLoader();
        File file = new File(classLoader.getResource("races.csv").getFile());

        try (Scanner sc = new Scanner(file)){
            sc.nextLine();
            while(sc.hasNext()){
                String line = sc.nextLine();
                if(line != null){
                    String[] rows = line.split(";");
                    //System.out.println("split");
                    em.persist(new Race(Long.valueOf(rows[0]), rows[1], LocalDate.parse(rows[2])));

                }
            }
        } catch (FileNotFoundException e) {
            e.printStackTrace();
        }
----
[source,java]
----
        URL url = Thread.currentThread().getContextClassLoader()
                .getResource("/" + racesFileName);
        try (Stream stream = Files.lines(Paths.get(url.getPath(), String.valueOf(StandardCharsets.UTF_8)))) {
            String[] rows = url.getFile().split(";");

            Race r = new Race();
            r.setId(Long.valueOf(rows[0]));
            r.setCountry(rows[1]);
            r.setDate(LocalDate.parse(rows[2], DateTimeFormatter.ofPattern("dd.mm.yyyy")));
            em.persist(r);

            stream.forEach(em::merge);

            //stream.forEach(this::);
        } catch (IOException e) {
            e.printStackTrace();
        }
----


teams.csv
[source,java]
----
ClassLoader classLoader = getClass().getClassLoader();
        File file = new File(classLoader.getResource(TEAM_FILE_NAME).getFile());

        try (BufferedReader br = new BufferedReader(new FileReader(file))){
            br.readLine();
            String first;
            while((first = br.readLine()) != null){
                String[] lines = first.split(";");
                Team t = new Team();

                em.persist(new Team(lines[0]));

                em.find(Team.class, t.getId());
                em.persist(new Driver(lines[1], t));
                em.persist(new Driver(lines[2], t));

                persistTeamAndDrivers(lines);
            }
        } catch (IOException e) {

----
[source, java]
----
        URL url = Thread.currentThread().getContextClassLoader()
                .getResource("/" + teamFileName);

        try (Stream stream = Files.lines(Paths.get(url.getPath(), String.valueOf(StandardCharsets.UTF_8)))){
            String[] rows = url.getFile().split(";");

            Team t = new Team();
            t.setName(rows[0]);
            //stream.forEach(em::merge);
            em.persist(t);

            Team team = em.find(Team.class, t.getId());
            Driver d1 = new Driver(rows[1], team);
            Driver d2 = new Driver(rows[2], team);
            em.persist(d1);
            em.persist(d2);
            //stream.forEach(em::merge);

            persistTeamAndDrivers(rows);

        } catch (IOException e) {
            e.printStackTrace();
        }
----





### Aufgabe 2

### Import von Daten vom REST

aus ResultsRestClient entfernt
[source, java]
----
@ApplicationPath("api")
----

RestConfig erstellt
[source,java]
----
package at.htl.formula1.boundary;

import javax.ws.rs.ApplicationPath;
import javax.ws.rs.core.Application;

@ApplicationPath("api")
public class RestConfig extends Application {
}
----

ResultRestClient.java
[source, java]
----
void persistResult(JsonArray resultsJson) {
    for (JsonValue jsonValue : resultsJson){
        JsonObject resultJson = jsonValue.asJsonObject();
        em.persist(resultJson);
    }
}
----
nicht fertig gemacht gehabt
[source,java]
----
void persistResult(JsonArray resultsJson) {
    for (JsonValue jsonValue : resultsJson){
        JsonObject resultJson = jsonValue.asJsonObject();
        Driver d = em.createNamedQuery("Driver.findByName", Driver.class)
                .setParameter("NAME", resultJson.getString("driverFullName"))
                .getSingleResult();
        Race r = em.find(Race.class, (long) resultJson.getInt("raceNo"));

        Result result = new Result();
        result.setDriver(d);
        result.setRace(r);
        result.setPoints(result.pointsPerPosition[result.getPoints()]);
        result.setPosition(resultJson.getInt("position"));
        em.persist(result);
    }
}
----


